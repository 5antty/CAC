TIMER  EQU 10H
PIC    EQU 20H
PIO    EQU 30H
EOI    EQU 20H
;Posiciones de las interrupciones en el vector de interrupcion
N_CLK  EQU  10

ORG   40
IP_CLK DW RUT_CLK

ORG   1000H
S     DB    0
FIN   DB    ?

ORG   3000H

CONTADOR: CMP CL, 0
JZ ES_CERO
CALL MULT
CMP CL, 128
JZ FINR
MAX: CALL 
ES_CERO: 
FINR:RET

MULT: PUSH AX
MOV CH, 0
CMP CL, 0
JZ FINM
CMP AL, 0
JZ FINM
LAZOM: ADD CH, CL
DEC AL
JNZ LAZOM
FINM: MOV CL, CH
POP AX
RET

RUT_CLK: PUSH AX
INC S
CMP S, 1
JNZ LUCES
MOV S, 0
LUCES:CMP CL, 0
JZ SIGO
CALL MULT
;CMP CL, 128
SIGO: MOV AL, CL
OUT PIO+1, AL
MOV AL, 0
OUT TIMER, AL
MOV AL, EOI
OUT PIC, AL
POP AX
IRET

ORG   2000H
CLI
MOV AL, 0FDH  ; 11111101
OUT PIC+1, AL ; PIC: registro IMR
MOV AL, N_CLK
OUT PIC+5, AL ; PIC: registro INT1
MOV AL, 1
OUT TIMER+1, AL ; TIMER: registro COMP
MOV AL, 0
OUT TIMER, AL ; TIMER: registro CONT
MOV AL, 0
OUT PIO+3, AL
OUT PIO+1, AL
MOV AL, 2
MOV CL, 1
STI
LAZO: JMP LAZO
END